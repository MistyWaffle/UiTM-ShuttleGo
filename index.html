<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UiTM ShuttleGo - Mobile App Prototype</title>
    <!-- 
        UiTM ShuttleGo V2.1
        -------------------
        Updates:
        - Added Dark Mode support.
        - Preserved Developer Credits.
        - Fixed minor visual bugs in dark mode map rendering.
    -->
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- HEADER -->
    <header>
        <div class="logo">
            üöå UiTM <span>ShuttleGo</span>
        </div>
        <div class="wallet-pill">
            RM <span id="headerBalance">0.00</span>
        </div>
    </header>

    <!-- MAIN CONTENT AREA -->
    <main id="mainContent">

        <!-- === VIEW: TRACKER === -->
        <section id="view-tracker" class="view-section active">
            <div class="container">

                <!-- Map Card -->
                <div class="card" style="padding:0;">
                    <div class="map-wrapper">
                        <svg id="shuttleMap" viewBox="0 0 400 300" width="100%" height="100%"
                            preserveAspectRatio="xMidYMid slice">
                            <!-- Background/Campus -->
                            <rect class="svg-bg" width="100%" height="100%" />
                            <rect class="svg-campus" x="50" y="50" width="300" height="200" rx="20" stroke-width="1" />

                            <!-- Route -->
                            <path d="M 80 80 L 320 80 L 320 220 L 80 220 Z" class="route-line" />
                            <path d="M 80 80 L 320 80 L 320 220 L 80 220 Z" class="route-active" />

                            <!-- Stops -->
                            <circle cx="80" cy="80" class="stop-dot" />
                            <text x="60" y="65" class="stop-text">Seri Mulu</text>

                            <circle cx="320" cy="80" class="stop-dot" />
                            <text x="300" y="65" class="stop-text">Seri Gading</text>

                            <circle cx="320" cy="220" class="stop-dot" />
                            <text x="300" y="245" class="stop-text">UiTM KS2</text>

                            <circle cx="80" cy="220" class="stop-dot" />
                            <text x="60" y="245" class="stop-text">The SummerMall</text>

                            <!-- Bus -->
                            <g id="busMarker" class="bus-marker">
                                <rect x="-12" y="-8" width="24" height="16" rx="4" fill="#FFD100" stroke="#333"
                                    stroke-width="1.5" />
                                <rect x="-9" y="-5" width="18" height="6" fill="#333" />
                                <circle cx="-6" cy="8" r="2.5" fill="#333" />
                                <circle cx="6" cy="8" r="2.5" fill="#333" />
                            </g>
                        </svg>
                        <!-- Status Overlay -->
                        <div
                            style="position:absolute; top:10px; left:10px; background:rgba(255,255,255,0.9); padding:4px 10px; border-radius:12px; font-size:0.75rem; box-shadow:0 2px 5px rgba(0,0,0,0.1);">
                            <span style="color:green;">‚óè</span> Live: <span id="speedIndicator"
                                style="color:#333;">Normal Traffic</span>
                        </div>
                    </div>
                </div>

                <!-- Nearby ETAs -->
                <div>
                    <h3 class="card-title" style="margin-bottom:10px;">Arrival Times</h3>
                    <div class="eta-scroller" id="etaContainer">
                        <!-- Populated via JS -->
                    </div>
                </div>

                <!-- Quick Action -->
                <div class="card" onclick="app.navTo('pay')"
                    style="background: linear-gradient(to right, #eef2f3, #e0eafc); cursor:pointer;">
                    <div style="display:flex; align-items:center; gap:15px;">
                        <div style="background:white; padding:10px; border-radius:50%;">üí≥</div>
                        <div style="color:#333;">
                            <div style="font-weight:bold;">Pay for Ride</div>
                            <div style="font-size:0.8rem; color:#666;">Tap to show QR Code</div>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- === VIEW: SCHEDULE === -->
        <section id="view-schedule" class="view-section">
            <div class="container">
                <h2 class="card-title">Shuttle Timetable</h2>

                <div class="card">
                    <table style="width:100%; border-collapse:collapse; font-size:0.9rem;">
                        <thead style="text-align:left; border-bottom:1px solid var(--map-stroke);">
                            <tr>
                                <th style="padding:10px; border-bottom:1px solid var(--map-stroke);">Stop</th>
                                <th style="padding:10px; border-bottom:1px solid var(--map-stroke);">Est. Arrival</th>
                            </tr>
                        </thead>
                        <tbody id="timetableBody">
                            <tr>
                                <td style="padding:10px; border-bottom:1px solid var(--map-stroke);">Kolej Seri Mulu
                                </td>
                                <td style="padding:10px; border-bottom:1px solid var(--map-stroke);">07:30 AM</td>
                            </tr>
                            <tr>
                                <td style="padding:10px; border-bottom:1px solid var(--map-stroke);">Kolej Gading
                                </td>
                                <td style="padding:10px; border-bottom:1px solid var(--map-stroke);">07:45 AM</td>
                            </tr>
                            <tr>
                                <td style="padding:10px; border-bottom:1px solid var(--map-stroke);">UiTM KS2
                                </td>
                                <td style="padding:10px; border-bottom:1px solid var(--map-stroke);">08:00 AM</td>
                            </tr>
                            <tr>
                                <td style="padding:10px;">The SummerMall</td>
                                <td style="padding:10px;">08:15 AM</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3 class="card-title" style="margin-top:10px;">Announcements</h3>
                <div id="announcementFeed">
                    <!-- JS Populated -->
                </div>
            </div>
        </section>

        <!-- === VIEW: PAY (WALLET) === -->
        <section id="view-pay" class="view-section">
            <div class="container">

                <!-- Wallet Balance Card -->
                <div class="card wallet-card">
                    <div style="font-size:0.9rem; opacity:0.9;">My Balance</div>
                    <div class="balance-display">RM <span id="walletBalance">0.00</span></div>
                    <div style="font-size:0.8rem; margin-bottom:1rem;">Student ID: 2025123456</div>

                    <div class="qr-container">
                        <!-- Simple CSS/SVG QR Code Mockup -->
                        <svg viewBox="0 0 100 100" width="120" height="120">
                            <rect width="100" height="100" fill="white" />
                            <path d="M10 10h30v30h-30zM60 10h30v30h-30zM10 60h30v30h-30z" fill="black" />
                            <rect x="15" y="15" width="20" height="20" fill="white" />
                            <rect x="65" y="15" width="20" height="20" fill="white" />
                            <rect x="15" y="65" width="20" height="20" fill="white" />
                            <rect x="20" y="20" width="10" height="10" fill="black" />
                            <rect x="70" y="20" width="10" height="10" fill="black" />
                            <rect x="20" y="70" width="10" height="10" fill="black" />
                            <path d="M45 10h10v10h-10zM45 30h10v10h-10zM10 45h10v10h-10zM30 45h10v10h-10z" fill="black"
                                opacity="0.8" />
                            <rect x="50" y="50" width="40" height="40" rx="2" fill="#006837" opacity="0.1" />
                        </svg>
                        <div style="color:#333; font-size:0.7rem; margin-top:5px;">Scan to Ride</div>
                    </div>

                    <p id="paymentFeedback" style="height:20px; font-size:0.85rem; font-weight:bold; color:#fff;"></p>
                </div>

                <!-- Actions -->
                <div class="action-grid">
                    <button class="btn btn-action" onclick="app.openTopUpModal()">
                        <div style="font-size:1.5rem;">‚ûï</div>
                        <span>Top Up</span>
                    </button>
                    <button class="btn btn-action" onclick="app.simulateScan()">
                        <div style="font-size:1.5rem;">üöå</div>
                        <span>Pay RM 2.00</span>
                    </button>
                </div>

                <div class="card">
                    <div class="card-title">Transaction History</div>
                    <ul style="list-style:none; font-size:0.85rem; color:var(--text-sub);" id="transactionList">
                        <li
                            style="padding:8px 0; border-bottom:1px solid #eee; display:flex; justify-content:space-between;">
                            <span>Initial Bonus</span> <span style="color:green;">+ RM 5.00</span>
                        </li>
                    </ul>
                </div>

            </div>
        </section>

        <!-- === VIEW: PROFILE (SETTINGS/ADMIN) === -->
        <section id="view-profile" class="view-section">
            <div class="container">
                <div class="card" style="display:flex; align-items:center; gap:15px;">
                    <div
                        style="width:60px; height:60px; background:#ddd; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1.5rem;">
                        üë§</div>
                    <div>
                        <div class="card-title" style="margin:0;">Student Name</div>
                        <div style="color:var(--text-sub); font-size:0.9rem;">Faculty of Business Management</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">App Settings</div>
                    </div>

                    <div style="margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
                        <span>Dark Mode</span>
                        <label class="switch" style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                            <input type="checkbox" id="themeToggle" onchange="app.toggleTheme(this.checked)">
                            <span id="themeLabel"
                                style="font-weight:bold; color:var(--uitm-purple); font-size:0.9rem;">OFF</span>
                        </label>
                    </div>

                    <hr style="border:0; border-top:1px solid var(--map-stroke); margin: 15px 0;">

                    <div style="margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
                        <span>Driver / Admin Mode</span>
                        <label class="switch" style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                            <input type="checkbox" id="adminToggle" onchange="app.toggleAdminMode(this.checked)">
                            <span id="adminLabel"
                                style="font-weight:bold; color:var(--uitm-purple); font-size:0.9rem;">OFF</span>
                        </label>
                    </div>
                </div>

                <!-- ADMIN CONSOLE (Hidden by default) -->
                <div id="adminConsole" class="card hidden"
                    style="border: 2px dashed var(--uitm-purple); background:var(--bg-neutral);">
                    <div class="card-title">üë®‚Äç‚úàÔ∏è Admin Controls</div>
                    <div style="display:grid; gap:10px;">
                        <button class="btn btn-danger" onclick="app.setTraffic(true)">‚ö†Ô∏è Report Traffic Jam (Slow
                            Bus)</button>
                        <button class="btn btn-outline" onclick="app.setTraffic(false)">‚ö° Clear Traffic Status</button>
                        <hr style="border:0; border-top:1px solid #eee;">
                        <input type="text" id="adminMsg" placeholder="Announcement text..."
                            style="padding:10px; border:1px solid #ddd; border-radius:8px; width:100%; background:var(--surface); color:var(--text-dark);">
                        <button class="btn btn-primary" onclick="app.postAnnouncement()">üì¢ Post Announcement</button>
                    </div>
                </div>

                <!-- CREDITS -->
                <div class="card" style="text-align: center; font-size: 0.9rem; color: var(--text-sub);">
                    Developed by <strong>Sylvester Ady Alichan</strong>
                </div>
            </div>
        </section>

    </main>

    <!-- NAVIGATION ISLAND -->
    <nav class="nav-island-container">
        <div class="nav-island">
            <div class="nav-item active" onclick="app.navTo('tracker')" id="nav-tracker">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" />
                </svg>
                <span>Tracker</span>
            </div>
            <div class="nav-item" onclick="app.navTo('schedule')" id="nav-schedule">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z" />
                </svg>
                <span>Schedule</span>
            </div>
            <div class="nav-item" onclick="app.navTo('pay')" id="nav-pay">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z" />
                </svg>
                <span>Pay</span>
            </div>
            <div class="nav-item" onclick="app.navTo('profile')" id="nav-profile">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                </svg>
                <span>Profile</span>
            </div>
        </div>
    </nav>

    <!-- TOP UP MODAL -->
    <div id="topUpModal" class="modal-overlay" onclick="if(event.target===this) app.closeModal()">
        <div class="modal">
            <h3 style="margin-bottom:15px;">Top Up Balance</h3>
            <p style="margin-bottom:15px; font-size:0.9rem; color:var(--text-sub);">Select Payment Method:</p>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:20px;">
                <button class="btn btn-outline" onclick="app.processTopUp(10)">RM 10</button>
                <button class="btn btn-outline" onclick="app.processTopUp(20)">RM 20</button>
                <button class="btn btn-outline" onclick="app.processTopUp(50)">RM 50</button>
                <button class="btn btn-outline" style="border-style:dashed;">Custom</button>
            </div>

            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:5px; font-size:0.8rem;">Source</label>
                <select class="btn"
                    style="border:1px solid #ccc; padding:10px; background:var(--surface); color:var(--text-dark);">
                    <option>MAE / Maybank2u</option>
                    <option>Touch 'n Go eWallet</option>
                    <option>Boost</option>
                    <option>Sarawak Pay</option>
                </select>
            </div>

            <button class="btn btn-primary" onclick="app.processTopUp(10)">Confirm Top Up</button>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script src="script.js"></script>
</body>

</html>